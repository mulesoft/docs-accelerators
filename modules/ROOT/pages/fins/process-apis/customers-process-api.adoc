= Customers Process API

This asset is a component of the https://www.mulesoft.com/exchange/org.mule.examples/mulesoft-accelerator-for-financial-services/[MuleSoft Accelerator for Financial Services^], which accelerates the implementation of essential integration use cases.

[cols="10,90"]
|===
| image:https://www.mulesoft.com/ext/solutions/draft/images/bulb.png[bulb.png]
| The xref:../../getting-started.adoc[Getting started guide] provides general information on getting started with the accelerator components. This includes instructions on setting up your local workstation for configuring and deploying the applications.
|===

== Summary

The FINS Customers Process API is used to orchestrate the Customer, Individual, Organization, and Household creation and update to/from the Salesforce FSC Banking, Salesforce FSC Insurance, Salesforce FSC Wealth, Salesforce Marketing, LOS, and Core Banking systems. 

This API uses the Accelerator Global Party Process API to maintain a global representation of a customer, which can provide a 360 degree view of the customer by storing identifiers representing the customer in various systems. A unique global ID is generated for each customer to uniquely identify the profiles being synchronized across all target systems. 

The Cloud Information Model (CIM) is leveraged to interact with each of the System APIs that have been developed for Customer sync use cases.

== Business Process

The following sequence diagram describes the process of synchronizing updates made to customers in Salesforce Financial Services Cloud to downstream systems:

image:https://www.mulesoft.com/ext/solutions/draft/images/fins-customer-update-sync-fsc-sequence.png[FSC Customer Sync]

== Using this Asset

The implementation template for this API can be imported directly into Anypoint Studio from Exchange. Ensure the required prerequisites are available and the mandatory property overrides are in place before attempting to run or deploy the application.

=== Anypoint Exchange Assets

Refer to the following links to download the assets for this API:

* https://anypoint.mulesoft.com/exchange/org.mule.examples/fins-customers-prc-api-spec/[API Specification^]

* https://anypoint.mulesoft.com/exchange/org.mule.examples/fins-customers-prc-api/[Implementation Template^]

=== Prerequisite Setup

The implementation template has the following dependencies:

* Anypoint MQ Destinations
* Accelerator Global Party Process API
* FINS Salesforce Customers System API (supports multiple deployments for separate FSC instances)
* FINS Salesforce Marketing System API
* FINS Core Banking Customers System API
* FINS Loan Origination System API

Please review the use cases described on the https://anypoint.mulesoft.com/exchange/8f5e182d-2f4a-4ac0-a319-28f660de099c/mulesoft-accelerator-for-financial-services/[MuleSoft Accelerator for Financial Services^] solution pages for more information about dependencies on other APIs and services.

==== Anypoint MQ Destinations

In addition to the Anypoint MQ client application credentials, the following destinations must be created and made accessible to this API:

* fins-partyrole-update-queue
* fins-partyrole-update-dl-queue
* fins-party-update-queue
* fins-party-update-dl-queue

The xref:./custom-components/fins-common-resources.adoc[FINS Common Resources] asset contains a Postman collection, which can be used to create the destinations and client application required for use by accelerator applications.

==== API Dependencies

The following table lists all endpoints used by this API (assuming all syncronization targets are enabled).

[%header%autowidth.spread]
|===
| API name | Endpoint | Action
| Accelerator Global Party Process API | get:/individuals | Search a individual party
| Accelerator Global Party Process API | get:/customers | Search a customer party role
| Accelerator Global Party Process API | get:/organizations | Search an organization party
| Accelerator Global Party Process API | get:households | Search an household party
| Accelerator Global Party Process API | put:/individuals | Create or update an individual party
| Accelerator Global Party Process API | put:/customers | Create or update a customer party role
| Accelerator Global Party Process API | put:/organizations | Create or update an organization party
| Accelerator Global Party Process API | put:/households | Create or update household party
| Accelerator Global Party Process API | put:/parties/{partyId}/contactPoints | Update contact points for a party
| Accelerator Global Party Process API | put:/parties/{partyId}/externalIds | Update external IDs for a party
| Accelerator Global Party Process API | put:/partyRoles/{partyRoleId}/externalIds | Update external IDs for a party role
| Accelerator Global Party Process API | get:/individuals/{individualId} | Retrieve an existing individual party
| Accelerator Global Party Process API | get:/customers/{customerId} | Retrieve an existing customer party role
| Accelerator Global Party Process API | get:/organizations/{organizationId} | Retrieve an existing organization party
| Accelerator Global Party Process API | get:/households/{householdId} | Retrieve an existing household party
| FINS Salesforce Customers System API | get:/customers | Search for an existing customer
| FINS Salesforce Customers System API | post:/customers | Create a new  customer
| FINS Salesforce Customers System API | patch:/customers/{customerId} | Update an existing customer
| FINS Salesforce Customers System API | get:/customers/{customerId} | Retrieve an existing customer
| FINS Salesforce Marketing System API | get:/subscribers | Search for an existing subscriber or individual party
| FINS Salesforce Marketing System API | post:/subscribers | Create a new subscriber or individual party
| FINS Salesforce Marketing System API | patch:/subscribers/{subscriberId} | Update an existing subscriber or individual party
| FINS Salesforce Marketing System API | get:/subscribers/{subscriberId} | Retrieve an existing subscriber or individual party
| FINS Core Banking Customers System API | get:/customers | Search for an existing customer
| FINS Core Banking Customers System API | post:/customers | Create a new  customer
| FINS Core Banking Customers System API | patch:/customers/{customerId} | Update an existing customer
| FINS Core Banking Customers System API | get:/customers/{customerId} | Retrieve an existing customer
| FINS Core Banking Customers System API | get:/customers/{customerId}/contactPoints | Retrieve contact points of an existing customer
| FINS Core Banking Customers System API | put:/customers/{customerId}/contactPoints | Update contact points of an existing customer
| FINS Loan Origination System API | get:/customers | Search for an existing customer
| FINS Loan Origination System API | post:/customers | Create a new  customer
| FINS Loan Origination System API | patch:/customers/{customerId} | Update an existing customer
| FINS Loan Origination System API | get:/customers/{customerId} | Retrieve an existing customer
|===

=== Mandatory Property Overrides

At a minimum, the following properties must be customized to reflect the target deployment environment before attempting to run or deploy the application.

[%header%autowidth.spread]
|===
|Property Name | Description
|api.autodiscoveryID | Required if using API Manager to secure this API
|anypoint-mq.server-url | Anypoint MQ URL where the  message Exchange, Topics, queues have been created
|anypoint-mq.client-id | Anypoint MQ Client Id to access messages from MQ
|anypoint-mq.client-secret | Anypoint MQ Client Secret to access messages from MQ
|global-party-prc.host | Accelerator Global Party Process API Hostname
|global-party-prc.port | Accelerator Global Party Process API Port
|global-party-prc.base-path | Accelerator Global Party Process API Base path
|salesforce-fsc-banking-sys.host | Hostname of FINS Salesforce Customers System API that is pointing to FSC Banking
|salesforce-fsc-banking-sys.port | Port of FINS Salesforce Customers System API that is pointing to FSC Banking
|salesforce-fsc-banking-sys.base-path | Base Path of FINS Salesforce Customers System API that is pointing to FSC Banking
|salesforce-fsc-banking-sys.enabled | Flag to enable or disable sync to FINS Salesforce Customers System API that is pointing to FSC Banking
|salesforce-fsc-insurance-sys.host | Hostname of FINS Salesforce Customers System API that is pointing to FSC Insurance
|salesforce-fsc-insurance-sys.port | Port of FINS Salesforce Customers System API that is pointing to FSC Insurance
|salesforce-fsc-insurance-sys.base-path | Base Path of FINS Salesforce Customers System API that is pointing to FSC Insurance
|salesforce-fsc-insurance-sys.enabled | Flag to enable or disable sync to FINS Salesforce Customers System API that is pointing to FSC Insurance
|salesforce-fsc-wealth-sys.host | Hostname of FINS Salesforce Customers System API that is pointing to FSC Wealth
|salesforce-fsc-wealth-sys.port | Port of FINS Salesforce Customers System API that is pointing to FSC Wealth
|salesforce-fsc-wealth-sys.base-path | Base Path of FINS Salesforce Customers System API that is pointing to FSC Wealth
|salesforce-fsc-wealth-sys.enabled | Flag to enable or disable sync to FINS Salesforce Customers System API that is pointing to FSC Wealth
|core-banking-sys.host | FINS Core Banking Customers System API Hostname
|core-banking-sys.port | FINS Core Banking Customers System API Port
|core-banking-sys.base-path | FINS Core Banking Customers System API Base path
|core-banking-sys.enabled | Flag to enable or disable sync to FINS Core Banking Customers System API
|los-sys.host | Loan Origination System API Hostname
|los-sys.port | Loan Origination System API Port
|los-sys.base-path | Loan Origination System API Base path
|los-sys.enabled | Flag to enable or disable sync to Loan Origination System API
|marketing-sys.host | FINS Salesforce Marketing System API Hostname
|marketing-sys.port | FINS Salesforce Marketing System API Port
|marketing-sys.base-path | FINS Salesforce Marketing System API path
|marketing-sys.enabled | Flag to enable or disable sync to FINS Salesforce Marketing System API
|===

== Data Mappings

This section provides information generated from the DataWeave scripts included in the project, such as function definitions, variable definitions, and data mapping tables.

=== map-customer-create-request

Customer Create Mapping for a System (Salesforce,CoreBanking and LOS)

> Source: `./src/main/resources/dwl/map-customer-create-request.dwl`

==== Mapping Tables

Maps customer profiles of SourceSystem to MDM in CIM format which is further used for creation of Customer in other systems (Salesforce,Core Banking etc.,). The object structure is same with only exception of Global Customer Id being sent as an ExternalId with ExternalIdType as MDM. This Id will be stored to uniquely identify the customer.

|===
| MDM | System | Description

| id
| id
| The id will be null for creating a new Customer

| partyRoleType
| partyRoleType
| The type of party role - usually Customer

| party
| party
| The Party

| externalIds
| externalIds
| The Global Customer Id of Customer as in MDM that will need to be stored in SAP ECC

| customerNumber
| customerNumber
| The Customer Number to be stored in a System

| customerStatus
| customerStatus
| The Status of Customer to be updated in a System
|===

=== map-salesforce-customer-create-request

Create Customer Mapping for Salesforce

> Source: `./src/main/resources/dwl/map-salesforce-customer-create-request.dwl`

==== Mapping Tables

Maps customer profiles from SourceSystem to MDM in CIM format which is further used to create a Customer in Salesforce. The object structure is same with only exception of GlobalCustomerId being sent as an ExternalId with ExternalIdType as MDM. This Id will be stored in Salesforce to uniquely identify the customer.

|===
| MDM | Salesforce | Description

| id
| id
| The id will be null for creating a new Customer in Salesforce

| partyRoleType
| partyRoleType
| The type of party role - usually Customer

| party
| party
| The Party

| externalIds
| externalIds
| The Global Customer Id of Customer as in MDM that will need to be stored in Salesforce

| customerNumber
| customerNumber
| The Customer Number to be stored in Salesforce

| customerStatus
| customerStatus
| The Status of Customer to be stored in Salesforce
|===

=== map-salesforce-customer-update-request

Update Customer Mapping for Salesforce

> Source: `./src/main/resources/dwl/map-salesforce-customer-update-request.dwl`

==== Mapping Tables

Maps customer profiles from SourceSystem to MDM in CIM format which is further used to update a Customer in Salesforce. The object structure is same with only exception of GlobalCustomerId being sent as an ExternalId with ExternalIdType as MDM. This Id will be stored in Salesforce to uniquely identify the customer.

|===
| MDM | Salesforce | Description

| id
| id
| The id of the Customer in Salesforce

| partyRoleType
| partyRoleType
| The type of party role - usually Customer

| party.id
| null
| The id of the Party

| party.partyType
| Party
| The type of Party

| party.personName
| firstName lastName
| The full name of the Party

| party.firstName
| firstName
| The first name of the Party

| party.lastName
| lastName
| The last name of the Party

| party.externalIds
| externalIds
| The GlobalPartyId of Customer as in MDM.This will not be stored in Salesforce

| externalIds
| externalIds
| The Global Customer Id of Customer as in MDM that will need to be stored in Salesforce

| customerNumber
| customerNumber
| The Customer Number to be stored in Salesforce

| customerStatus
| customerStatus
| The Status of Customer to be updated in Salesforce
|===

=== map-salesforce-individual-create-request

Create Contact Mapping for Salesforce

> Source: `./src/main/resources/dwl/map-salesforce-individual-create-request.dwl`

==== Mapping Tables

Maps Individual profiles from SourceSystem to MDM in CIM format which is further used to create an Individual in Salesforce. The object structure is same with only exception of GlobalPartyId being sent as an ExternalId with ExternalIdType as MDM. This Id will be stored in Salesforce to uniquely identify the Contact.

|===
| MDM | Salesforce | Description

| id
| id
| The id will be null for creating a new Contact in Salesforce

| partyType
| partyType
| The Party type for the Contact - Set as Individual

| contactPoints
| contactPoints
| The ContactPoints associated with the Individual

| externalIds
| externalIds
| The Global Customer Id of Customer as in MDM that will need to be stored in Salesforce

| personName
| personName
| The Name of the Contact to be stored in Salesforce

| firstName
| firstName
| The First Name of the Contact to be stored in Salesforce

| lastName
| lastName
| The Last Name of the Contact to be stored in Salesforce
|===

=== map-salesforce-individual-update-request

Update Contact Mapping for Salesforce

> Source: `./src/main/resources/dwl/map-salesforce-individual-update-request.dwl`

==== Mapping Tables

Maps Individual profiles of SourceSystem to MDM in CIM format which is further used to update a Contact in Salesforce. The object structure is same with only exception of GlobalPartyId being sent as an ExternalId with ExternalIdType as MDM. This Id will be stored in Salesforce to uniquely identify the Contact.

|===
| MDM | Salesforce | Description

| id
| id
| The id will be null for creating a new Contact in Salesforce

| partyType
| partyType
| The Party type for the Contact - Set as Individual

| externalIds
| externalIds
| The Global Customer Id of Customer as in MDM that will need to be stored in Salesforce

| personName
| personName
| The Name of the Contact to be stored in Salesforce

| firstName
| firstName
| The First Name of the Contact to be stored in Salesforce

| lastName
| lastName
| The Last Name of the Contact to be stored in Salesforce
|===

=== map-salesforce-household-create-request

Create Household Mapping for Salesforce

> Source: `./src/main/resources/dwl/map-salesforce-household-create-request.dwl`

==== Mapping Tables

Maps Household profiles from SourceSystem to MDM in CIM format which is further used to create an Household in Salesforce. The object structure is same with only exception of GlobalPartyId being sent as an ExternalId with ExternalIdType as MDM. This Id will be stored in Salesforce to uniquely identify the Contact.

|===
| MDM | Salesforce | Description

| id
| id
| The id will be null for creating a new Contact in Salesforce

| partyType
| partyType
| The Party type for the Contact - Set as Household

| externalIds
| externalIds
| The Global Customer Id of Customer as in MDM that will need to be stored in Salesforce

| name
| name
| The Name of the Household to be stored in Salesforce
|===

=== map-salesforce-household-update-request

Update Household Mapping for Salesforce

> Source: `./src/main/resources/dwl/map-salesforce-household-update-request.dwl`

==== Mapping Tables

Maps Household profiles from SourceSystem to MDM in CIM format which is further used to update an Household in Salesforce. The object structure is same with only exception of GlobalPartyId being sent as an ExternalId with ExternalIdType as MDM. This Id will be stored in Salesforce to uniquely identify the Contact.

|===
| MDM | Salesforce | Description

| id
| id
| The id will be null for creating a new Contact in Salesforce

| partyType
| partyType
| The Party type for the Contact - Set as Household

| externalIds
| externalIds
| The Global Customer Id of Customer as in MDM that will need to be stored in Salesforce

| name
| name
| The Name of the Household to be stored in Salesforce
|===

=== map-subscriber-create-request

Individual/Subscriber Creation Mapping for Salesforce Marketing

> Source: `./src/main/resources/dwl/map-subscriber-create-request.dwl`

==== Mapping Tables

Maps Individual associated with Customer Profile of SourceSystem (Salesforce) to MDM in CIM format which is further used for creation of Subscriber in Salesforce Marketing. The object structure is same with only exception of Global Customer Id being sent as an ExternalId with ExternalIdType as MDM. This Id will be stored in Salesforce Marketing to uniquely identify an Individual.

|===
| MDM | Salesforce Marketing | Description

| id
| id
| The id will be null for creating a new Subscriber in Salesforce Marketing

| partyType
| Individual
| The type of party - default as Individual

| personName
| firstName lastName
| The full name of the individual

| firstName
| firstName
| The first name of the individual

| lastName
| lastName
| The last name of the individual

| externalIds
| externalIds
| The GlobalPartyId of an Individual as in MDM.This will not be stored in Salesforce Marketing

| contactPoints
| contactPoints
| The ContactPoints  of an Individual used for creating a Subscriber in Salesforce Marketing Cloud. ContactPointEmailAddress is only used by Salesforce Marketing Cloud
|===

=== map-subscriber-update-request

Individual/Subscriber Update Mapping for Salesforce Marketing

> Source: `./src/main/resources/dwl/map-subscriber-update-request.dwl`

==== Mapping Tables

Maps Individual associated with Customer Profile of SourceSystem (Salesforce) to MDM in CIM format which is further used for creation of Subscriber in Salesforce Marketing. The object structure is same with only exception of GlobalPartyId being sent as an ExternalId to be stored in Salesforce Marketing to uniquely identify an Individual.

|===
| MDM | Salesforce Marketing | Description

| id
| id
| The id will be GlobalPartyId for updating an existing Subscriber in Salesforce Marketing

| partyType
| Individual
| The type of party - default as Individual

| personName
| firstName lastName
| The full name of the individual

| firstName
| firstName
| The first name of the individual

| lastName
| lastName
| The last name of the individual

| externalIds
| externalIds
| The GlobalPartyId of an Individual as in MDM.This will not be stored in Salesforce Marketing

| contactPoints
| contactPoints
| The ContactPoints  of an Individual used for creating a Subscriber in Salesforce Marketing Cloud. ContactPointEmailAddress is only used by Salesforce Marketing Cloud
|===

=== map-core-banking-customer-create-request

Customer Create Mapping for Core Banking

> Source: `./src/main/resources/dwl/map-core-banking-customer-create-request.dwl`

==== Mapping Tables

Maps customer profiles of SourceSystem to CIM format which is further used for creation of Customer in Core Banking. The object structure is same with only exception of Global Customer Id being sent as an ExternalId with ExternalIdType as MDM.

|===
| MDM | Core Banking | Description

| id
| id
| The id will be null for creating a new Customer in Core Banking

| partyRoleType
| partyRoleType
| The type of party role - usually Customer

| party
| party
| The Party

| externalIds
| externalIds
| The Global Customer Id of Customer as in MDM that will need to be stored in Core Banking

| customerNumber
| customerNumber
| The Customer Number to be stored in Core Banking

| customerStatus
| customerStatus
| The Status of Customer to be updated in Core Banking
|===

=== map-core-banking-customer-update-request

Customer Update Mapping for Core Banking

> Source: `./src/main/resources/dwl/map-core-banking-customer-update-request.dwl`

=== Mapping Tables

Maps customer profiles of SourceSystem in CIM format which is further used for creation of Customer in Core Banking. The object structure is same with only exception of Global Customer Id being sent as an ExternalId with ExternalIdType as MDM.

|===
| MDM | Core Banking | Description

| id
| id
| The id will be Global Customer Id to update an existing Customer in Core Banking

| partyRoleType
| partyRoleType
| The type of party role - usually Customer

| party.id
| null
| The id of the Party

| party.partyType
| Party
| The type of Party

| party.personName
| firstName lastName
| The full name of the Party

| party.firstName
| firstName
| The first name of the Party

| party.lastName
| lastName
| The last name of the Party

| party.externalIds
| externalIds
| The GlobalPartyId of Customer as in MDM.This will not be stored in Core Banking

| party.contactPoints
| contactPoints
| The contactPoints of Customer as in MDM.

| externalIds
| externalIds
| The Global Customer Id of Customer as in MDM that will need to be stored in Core Banking

| customerNumber
| customerNumber
| The Customer Number to be stored in Core Banking

| customerStatus
| customerStatus
| The Status of Customer to be updated in Core Banking
|===

=== map-los-customer-create-request

Customer Create Mapping for Loan Origination System (LOS)

> Source: `./src/main/resources/dwl/map-los-customer-create-request.dwl`

==== Mapping Tables

Maps customer profiles of SourceSystem to CIM format which is further used for creation of Customer in LOS. The object structure is same with only exception of Global Customer Id being sent as an ExternalId with ExternalIdType as MDM.

|===
| MDM | Core Banking | Description

| id
| id
| The id will be null for creating a new Customer in LOS

| partyRoleType
| partyRoleType
| The type of party role - usually Customer

| party
| party
| The Party

| externalIds
| externalIds
| The Global Customer Id of Customer as in MDM that will need to be stored in LOS

| customerNumber
| customerNumber
| The Customer Number to be stored in LOS

| customerStatus
| customerStatus
| The Status of Customer to be updated in LOS
|===

=== map-los-customer-update-request

Customer Update Mapping for Loan Origination System (LOS)

> Source: `./src/main/resources/dwl/map-los-customer-update-request.dwl`

==== Mapping Tables

Maps customer profiles of SourceSystem in CIM format which is further used for creation of Customer in LOS. The object structure is same with only exception of Global Customer Id being sent as an ExternalId with ExternalIdType as MDM.

|===
| MDM | LOS | Description

| id
| id
| The id will be Global Customer Id to update an existing Customer in LOS

| partyRoleType
| partyRoleType
| The type of party role - usually Customer

| party.id
| null
| The id of the Party

| party.partyType
| Party
| The type of Party

| party.personName
| firstName lastName
| The full name of the Party

| party.firstName
| firstName
| The first name of the Party

| party.lastName
| lastName
| The last name of the Party

| party.externalIds
| externalIds
| The GlobalPartyId of Customer as in MDM.This will not be stored in LOS

| party.contactPoints
| contactPoints
| The contactPoints of Customer as in LOS.

| externalIds
| externalIds
| The Global Customer Id of Customer as in MDM that will need to be stored in LOS

| customerNumber
| customerNumber
| The Customer Number to be stored in LOS

| customerStatus
| customerStatus
| The Status of Customer to be updated in LOS
|===

== See Also

* xref:../../getting-started.adoc[Getting Started]
* xref:/fins/fins-landing-page.adoc[MuleSoft Accelerator for Financial Services]
